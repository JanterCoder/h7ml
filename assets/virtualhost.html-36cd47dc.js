import{_ as i,r as t,o as c,c as l,a as n,b as s,d as o,f as a}from"./app-2a9bb723.js";const d={},r=a(`<h2 id="配置与应用场景" tabindex="-1"><a class="header-anchor" href="#配置与应用场景" aria-hidden="true">#</a> 配置与应用场景</h2><h2 id="域名解析" tabindex="-1"><a class="header-anchor" href="#域名解析" aria-hidden="true">#</a> 域名解析</h2><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909095951565.png" alt="image-20220909095951565" tabindex="0" loading="lazy"><figcaption>image-20220909095951565</figcaption></figure><h3 id="浏览器、nginx-与-http-协议" tabindex="-1"><a class="header-anchor" href="#浏览器、nginx-与-http-协议" aria-hidden="true">#</a> 浏览器、Nginx 与 HTTP 协议</h3><ul><li>电脑拿到 IP 地址、首先会先发送 TCP/IP 协议（HTTP 或 HTTPS 协议在 TCP/IP 协议之上，TCP/IP 协议只能传输二进制数据）。</li><li>在宽带（电信、联通、移动）的主干网上会进过很多个网关（也可以理解为路由器）。</li><li>从家里的网关=&gt;&gt;小区的网关=&gt;&gt;服务商的网关=&gt;&gt;（电信、联通、移动）的网关=&gt;&gt;区域的网关=&gt;&gt;市里的网关=&gt;&gt;全国的总网关=&gt;&gt;最后才到主干网上。</li><li>HTTPS 就是在这个过程中给你是数据进行了加密。</li></ul><h2 id="虚拟主机的原理" tabindex="-1"><a class="header-anchor" href="#虚拟主机的原理" aria-hidden="true">#</a> 虚拟主机的原理</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>域名/IP ==&gt; Nginx，访问服务器获取资源

域名/IP &lt;== Nginx, 服务器返回资源
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样的话一台主机就可以给外界公布一个公网 IP，如果公网 IP 只绑定了一个 IP 地址上，这样就有可能会造成<strong>性能过剩</strong>，因为这一台主机不会时时的高访问。</p><p>如果将多个域名绑定到一台主机上，在<strong>通过 Nginx 服务器来判断你访问的是哪一个域名</strong>，之后在返回给你对应的资源</p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909111838691.png" alt="image-20220909111838691" tabindex="0" loading="lazy"><figcaption>image-20220909111838691</figcaption></figure><h3 id="本地域名解析" tabindex="-1"><a class="header-anchor" href="#本地域名解析" aria-hidden="true">#</a> 本地域名解析</h3><p>找到本地主机的 hosts 文件 <code>C:\\Windows\\System32\\drivers\\etc</code></p><p>在最后加上：</p><p>IP 地址 域名</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>192.168.88.100 hadoop100.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="公网域名配置与泛域名解析" tabindex="-1"><a class="header-anchor" href="#公网域名配置与泛域名解析" aria-hidden="true">#</a> 公网域名配置与泛域名解析</h3><p>首先需要一个域名，购买渠道阿里云、腾讯云，这里已阿里云</p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909131341414.png" alt="image-20220909131341414" tabindex="0" loading="lazy"><figcaption>image-20220909131341414</figcaption></figure><p><strong>主机记录</strong></p>`,19),p=n("li",null,"第一种：指定前缀的，例如 www 之类的。",-1),u={href:"http://gopeak.cn",target:"_blank",rel:"noopener noreferrer"},v=n("code",null,"www.gopeak.cn",-1),m=n("li",null,[s("第三种：填 "),n("code",null,"*"),s("（通配符），这样所有的二级，三级等域名"),n("strong",null,"都会匹配到当前主机上")],-1),k=a(`<p><strong>记录值</strong>：也就是主机名</p><h3 id="配置多个虚拟主机" tabindex="-1"><a class="header-anchor" href="#配置多个虚拟主机" aria-hidden="true">#</a> 配置多个虚拟主机</h3><p><strong>域名设置</strong></p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220909144630354.png" alt="image-20220909144630354" tabindex="0" loading="lazy"><figcaption>image-20220909144630354</figcaption></figure><p><strong>Nginx 设置</strong></p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 虚拟主机 vhost</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 域名 主机名</span>
        <span class="token directive"><span class="token keyword">server_name</span>  www.gopeak.cn</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   /www/www</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 虚拟主机 vhost</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 域名 主机名</span>
        <span class="token directive"><span class="token keyword">server_name</span>  vod.gopeak.cn</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   /www/vodi</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="最小配置" tabindex="-1"><a class="header-anchor" href="#最小配置" aria-hidden="true">#</a> 最小配置</h3><h4 id="worker-processes" tabindex="-1"><a class="header-anchor" href="#worker-processes" aria-hidden="true">#</a> worker_processes</h4><ul><li><code>worker_processes 1</code>; 默认为 1，表示<strong>开启一个业务进程</strong></li></ul><h4 id="worker-connections" tabindex="-1"><a class="header-anchor" href="#worker-connections" aria-hidden="true">#</a> worker_connections</h4><ul><li><code>worker_connections 1024</code>; <strong>单个业务</strong>进程可接受连接数</li></ul><h4 id="include-mime-types" tabindex="-1"><a class="header-anchor" href="#include-mime-types" aria-hidden="true">#</a> include mime.types</h4><ul><li><code>include mime.types</code>; 引入<code>http mime</code>类型，<strong>在请求头中标明服务端给客户端返回的文件是什么类型的文件</strong>。</li></ul><h4 id="default-type-application-octet-stream" tabindex="-1"><a class="header-anchor" href="#default-type-application-octet-stream" aria-hidden="true">#</a> default_type application/octet-stream</h4><ul><li><code>default_type application/octet-stream</code>; <strong>如果<code>mime</code>类型没匹配上</strong>，默认使用二进制流的方式传输。</li></ul><h4 id="sendfile-on" tabindex="-1"><a class="header-anchor" href="#sendfile-on" aria-hidden="true">#</a> sendfile on</h4><ul><li><code>sendfile on</code>; 使用<code>linux</code>的 <code>sendfile(socket, file, len)</code> 高效网络传输，也就是数据 0 拷贝。</li></ul><p><strong>未开启<code>sendfile</code></strong></p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907111843362.png" alt="image-20220907111843362" tabindex="0" loading="lazy"><figcaption>image-20220907111843362</figcaption></figure><p><strong>开启<code>sendfile</code>后</strong></p><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907111937461.png" alt="image-20220907111937461" tabindex="0" loading="lazy"><figcaption>image-20220907111937461</figcaption></figure><h4 id="keepalive-timeout-65" tabindex="-1"><a class="header-anchor" href="#keepalive-timeout-65" aria-hidden="true">#</a> keepalive_timeout 65</h4><ul><li>keepalive_timeout 65;</li></ul><h4 id="server" tabindex="-1"><a class="header-anchor" href="#server" aria-hidden="true">#</a> server</h4><figure><img src="https://static.h7ml.cn/vitepress/assets/images/nginx/image-20220907112032197.png" alt="image-20220907112032197" tabindex="0" loading="lazy"><figcaption>image-20220907112032197</figcaption></figure><h3 id="虚拟主机配置" tabindex="-1"><a class="header-anchor" href="#虚拟主机配置" aria-hidden="true">#</a> 虚拟主机配置</h3><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>   <span class="token number">80</span></span><span class="token punctuation">;</span> 监听端口号
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span> 主机名、域名

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span> 匹配路径
        <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span> 文件根目录
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span> 默认页名称
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span> 报错编码对应页面
    <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
     <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="虚拟主机" tabindex="-1"><a class="header-anchor" href="#虚拟主机" aria-hidden="true">#</a> 虚拟主机</h4><p>原本一台服务器只能对应一个站点，通过虚拟主机技术可以虚拟化成多个站点同时对外提供服务</p><h4 id="servername-匹配规则" tabindex="-1"><a class="header-anchor" href="#servername-匹配规则" aria-hidden="true">#</a> servername 匹配规则</h4><p>我们需要注意的是<code>servername</code>匹配分先后顺序，写在前面的匹配上就不会继续往下匹配了。</p><h4 id="完整匹配" tabindex="-1"><a class="header-anchor" href="#完整匹配" aria-hidden="true">#</a> 完整匹配</h4><p>我们可以在同一<code>servername</code>中匹配多个域名</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server_name</span> vod.mmban.com www1.mmban.com</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="通配符匹配" tabindex="-1"><a class="header-anchor" href="#通配符匹配" aria-hidden="true">#</a> 通配符匹配</h4><h4 id="通配符结束匹配" tabindex="-1"><a class="header-anchor" href="#通配符结束匹配" aria-hidden="true">#</a> 通配符结束匹配</h4><h4 id="正则匹配" tabindex="-1"><a class="header-anchor" href="#正则匹配" aria-hidden="true">#</a> 正则匹配</h4><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server_name</span> ~^[0-9]+\\.mmban\\.com$</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,38);function h(g,b){const e=t("ExternalLinkIcon");return c(),l("div",null,[r,n("ul",null,[p,n("li",null,[s("第二种：不填，例如我现在的域名是 "),n("a",u,[s("gopeak.cn"),o(e)]),s(" ,也会匹配到 "),v,s("。")]),m]),k])}const f=i(d,[["render",h],["__file","virtualhost.html.vue"]]);export{f as default};
