import{_ as t,r as o,o as p,c as i,a as n,b as s,d as e,f as c}from"./app-2a9bb723.js";const l={},r=n("h2",{id:"selenium",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#selenium","aria-hidden":"true"},"#"),s(" selenium")],-1),u=n("h2",{id:"scrapy-selenium-抓取动态页面",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#scrapy-selenium-抓取动态页面","aria-hidden":"true"},"#"),s(" scrapy + selenium 抓取动态页面")],-1),d={href:"https://cloud.tencent.com/developer/article/2016732",target:"_blank",rel:"noopener noreferrer"},m=n("h3",{id:"安装-selenium",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#安装-selenium","aria-hidden":"true"},"#"),s(" 安装 selenium")],-1),k=n("h3",{id:"下载-selenium-调试工具",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#下载-selenium-调试工具","aria-hidden":"true"},"#"),s(" 下载 selenium 调试工具")],-1),v={href:"https://registry.npmmirror.com/binary.html?path=chromedriver/",target:"_blank",rel:"noopener noreferrer"},b=c(`<h3 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h3><p>1、在 <code>middlewares.py</code> 文件中修改返回的 <code>response</code> 对象</p><p>找到 <code>Scrapy[这里是你的项目名字]sDownloaderMiddleware</code> 类，修改<code>process_request</code>方法</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code> <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># 在 DownloaderMiddleware 中更改 process_request 返回的 response 对象</span>
        <span class="token comment"># 通过 webdriver 构建的 driver 对象去请求js渲染后的页面</span>
        options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
        options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--headless&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 浏览器不提供可视化界面。Linux下如果系统不支持可视化不加这条会启动失败</span>
        options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;blink-settings=imagesEnabled=false&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 不加载图片，提升运行速度</span>
        options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--disable-gpu&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 谷歌文档提到需要加上这个属性来规避bug</span>
        options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;no-sandbox&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 取消沙盒模式</span>
        options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;disable-blink-features=AutomationControlled&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 禁用启用Blink运行时的功能</span>
        options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">&#39;excludeSwitches&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;enable-automation&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 开发者模式</span>

        <span class="token comment"># executable_path 是你的 selenium 调试工具的路径</span>
        driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span><span class="token string">&#39;/Users/mulin/Chrome/chromedriver&#39;</span><span class="token punctuation">,</span> options<span class="token operator">=</span>options<span class="token punctuation">)</span>
        <span class="token comment"># 移除 \`window.navigator.webdriver\`. scrapy 默认为True</span>
        driver<span class="token punctuation">.</span>execute_cdp_cmd<span class="token punctuation">(</span><span class="token string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;source&quot;</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
                     Object.defineProperty(navigator, &#39;webdriver&#39;, {
                       get: () =&amp;gt; undefined
                     })
                   &quot;&quot;&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        content <span class="token operator">=</span> driver<span class="token punctuation">.</span>page_source
        <span class="token comment"># 关闭 webdriver</span>
        driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 引入 HtmlResponse 函数来重新返回 response 对象</span>
        <span class="token keyword">return</span> HtmlResponse<span class="token punctuation">(</span>url<span class="token operator">=</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> body<span class="token operator">=</span>content<span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3、在<code>settings.py</code>文件中打开<code>SPIDER_MIDDLEWARES</code> 、<code>DOWNLOADER_MIDDLEWARES</code> 和<code>DOWNLOAD_DELAY</code>配置</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Configure a delay for requests for the same website (default: 0)</span>
<span class="token comment"># See https://docs.scrapy.org/en/latest/topics/settings.html#download-delay</span>
<span class="token comment"># See also autothrottle settings and docs</span>
DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">2</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># Enable or disable spider middlewares</span>
<span class="token comment"># See https://docs.scrapy.org/en/latest/topics/spider-middleware.html</span>
SPIDER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">&#39;scrapy_yys.middlewares.ScrapyYysSpiderMiddleware&#39;</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># Enable or disable downloader middlewares</span>
<span class="token comment"># See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html</span>
DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">&#39;scrapy_yys.middlewares.ScrapyYysDownloaderMiddleware&#39;</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6);function h(_,g){const a=o("ExternalLinkIcon");return p(),i("div",null,[r,u,n("p",null,[n("a",d,[s("腾讯云博客 open in new window"),e(a)])]),m,k,n("p",null,[s("Chrome"),n("a",v,[s("下载地址 open in new window"),e(a)]),s("，版本与 Chrome 最近即可")]),b])}const y=t(l,[["render",h],["__file","selenium.html.vue"]]);export{y as default};
